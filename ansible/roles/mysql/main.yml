---
- name: Setup Rails application with MariaDB-devel
  hosts: all
  become: true
  tasks:
    - name: Update all packages
      yum:
        name: "*"
        state: latest

    - name: Install required libraries for mysql2 gem
      yum:
        name:
          - mariadb-devel
          - gcc
          - gcc-c++
          - make
        state: present

    - name: Install bundler
      shell: "/bin/bash -lc 'gem install bundler'"
      args:
        creates: "/usr/local/bin/bundle"

    - name: Run bundle install
      shell: "/bin/bash -lc 'bundle install'"
      args:
        chdir: "{{ app_dir }}"
